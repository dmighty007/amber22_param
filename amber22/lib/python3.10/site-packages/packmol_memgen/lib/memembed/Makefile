-include ../../../../config.h
ifeq ($(CC),gcc)
	GCC_VER_GET47 := $(shell echo `$(CXX) -dumpversion | cut -f1-2 -d.` \>= 4.7 | bc )
	ifeq ($(GCC_VER_GET47),1)
		CFLAGS = -Wall -Wextra -O3 -fPIC -std=c++11 -fvisibility=hidden
	else
		CFLAGS = -Wall -Wextra -O3 -fPIC -std=c++0x -fvisibility=hidden
	endif
else
        CFLAGS=$(CXXOPTFLAGS)
endif

ifndef AMBER_SOURCE
	INC = -Isrc
	LIBS = -lboost_thread -lboost_system -lpthread
else
	INC = -Isrc -I$(INCDIR)
	LIBS = -L$(LIBDIR) -lboost_thread -lboost_system -lpthread
endif

all: memembed

src/pdb.o: src/pdb.cpp
	@echo "[MEMEMBED]  CXX $<"
	$(VB)$(CXX) $(CFLAGS) $(INC) -c src/pdb.cpp -o src/pdb.o

src/ga.o: src/ga.cpp
	@echo "[MEMEMBED]  CXX $<"
	$(VB)$(CXX) $(CFLAGS) $(INC) -c src/ga.cpp -o src/ga.o

src/direct.o: src/direct.cpp
	@echo "[MEMEMBED]  CXX $<"
	$(VB)$(CXX) $(CFLAGS) $(INC) -c src/direct.cpp -o src/direct.o

src/grid.o: src/grid.cpp
	@echo "[MEMEMBED]  CXX $<"
	$(VB)$(CXX) $(CFLAGS) $(INC) -c src/grid.cpp -o src/grid.o

src/main.o: src/main.cpp
	@echo "[MEMEMBED]  CXX $<"
	$(VB)$(CXX) $(CFLAGS) $(INC) -c src/main.cpp -o src/main.o

memembed: src/pdb.o src/ga.o src/grid.o src/direct.o src/main.o
	@echo "[MEMEMBED]  CXX $@"
	$(VB)$(CXX) $(CFLAGS) $(INC) src/main.o src/pdb.o src/ga.o src/grid.o src/direct.o ${LIBS} -o bin/memembed

clean:
	rm -f bin/memembed src/*.o examples/*EMBED.pdb

test:
	bin/memembed -t 4,26,46,68 -n out -q 1 -a 2 examples/2x2v.pdb

